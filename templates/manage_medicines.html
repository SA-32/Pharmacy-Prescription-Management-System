<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Medicines - PharmaCare</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo-container">
            <i class="fas fa-prescription-bottle-alt pharma-icon"></i>
            <h1>PharmaCare Admin</h1>
        </div>
        
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
                <li><a href="{{ url_for('manage_medicines') }}">Manage Medicines</a></li>
                <li><a href="{{ url_for('index') }}">View Site</a></li>
            </ul>
            
            <div class="auth-buttons">
                <span class="welcome-msg">Admin Panel</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
        </div>
    </nav>

    <main class="admin-main">
        <h2>Manage Medicines</h2>
        
        <div class="admin-actions">
            <button id="add-medicine-btn" class="btn-primary">Add New Medicine</button>
        </div>
        
        <!-- Add Medicine Form (initially hidden) -->
        <div id="add-medicine-form" class="form-container" style="display: none;">
            <h3>Add New Medicine</h3>
            <form method="POST" action="{{ url_for('manage_medicines') }}">
                <div class="form-group">
                    <label for="name">Medicine Name:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="purpose">Purpose:</label>
                    <input type="text" id="purpose" name="purpose" required>
                </div>
                <div class="form-group">
                    <label for="expiry">Expiry Date:</label>
                    <input type="date" id="expiry" name="expiry" required>
                </div>
                <div class="form-group">
                    <label for="price">Price (Rs):</label>
                    <input type="number" id="price" name="price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="stock">stock :</label>
                    <input type="number" id="stock" name="stock" required>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Save Medicine</button>
                    <button type="button" id="cancel-add" class="btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
        
        <!-- Medicine List -->
        <div class="medicine-list-container">
            <table class="medicine-list">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Purpose</th>
                        <th>Expiry</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for medicine in medicines %}
                    <tr>
                        <td>{{ medicine.medicine_id }}</td>
                        <td>{{ medicine.name }}</td>
                        <td>{{ medicine.purpose }}</td>
                        <td>{{ medicine.expiry }}</td>
                        <td>Rs{{ "%.2f"|format(medicine.price) }}</td>
                        <td>{{ medicine.stock }}</td>
                        <td>
                            <button class="btn-danger delete-medicine" data-id="{{ medicine.medicine_id }}">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>

    <footer class="admin-footer">
        <p>&copy; 2025 PharmaCare Admin Panel. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle add medicine form
            const addBtn = document.getElementById('add-medicine-btn');
            const addForm = document.getElementById('add-medicine-form');
            const cancelBtn = document.getElementById('cancel-add');
            
            addBtn.addEventListener('click', function() {
                addForm.style.display = 'block';
            });
            
            cancelBtn.addEventListener('click', function() {
                addForm.style.display = 'none';
            });
            
            // Handle delete medicine buttons
            document.querySelectorAll('.delete-medicine').forEach(button => {
                button.addEventListener('click', function() {
                    const medicineId = this.getAttribute('data-id');
                    
                    if (confirm('Are you sure you want to delete this medicine?')) {
                        fetch('/admin/delete_medicine/' + medicineId, {
                            method: 'POST'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert('Medicine deleted successfully');
                                location.reload();
                            } else {
                                alert('Error: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Error deleting medicine');
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>